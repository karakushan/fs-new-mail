!function(e){"use strict";function t(e){return e==fsNmOptions.pochtomatId||e==fsNmOptions.warehouseId}var a,n=(a=0,function(e,t){clearTimeout(a),a=setTimeout(e,t)});e(document).on("click",'[name="fs_city"]',(function(t){e('[data-fs-element="select-delivery-city"]').length>0&&e('[data-fs-element="select-delivery-city"]').fadeIn()})),e(document).on("input",'[name="fs_city"]',(function(){const a=e(this),s=e(this).val();let l=e("[name='fs_delivery_methods']").val();e('[name="fs_delivery_number"]').val(""),s.trim().length<3||("radio"!=e("[name='fs_delivery_methods']").attr("type")&&"checkbox"!=e("[name='fs_delivery_methods']").attr("type")||(l=e("[name='fs_delivery_methods']:checked").val()),t(l)&&n((function(){e.ajax({url:fShop.ajaxurl,type:"POST",data:{action:"fs_get_city",cityName:s},beforeSend:function(){e('[name="fs_city"]').parent().append('<img src="/wp-content/plugins/fs-new-mail/assets/img/preloader.svg" data-fs-element="select-city-loader" class="loader">')}}).done((function(t){if(t.success){e('[data-fs-element="select-city-loader"]').remove(),a.parent().find('[data-fs-element="select-delivery-city"]').remove(),a.parent().find(".errors").remove();let n="";t.data.cities.length>0&&t.data.cities.forEach((function(e){n+='<li class="select-city-item" data-ref="'+e.ref+'">'+e.name+"</li>"})),0!==e('[data-fs-element="select-delivery-city"]').length?e('[data-fs-element="select-delivery-city"]').html(n):e(document).find("#fs_city").after('<ul class="nm-city" data-fs-element="select-delivery-city">'+n+"</ul>")}else a.parent().find('[data-fs-element="select-delivery-city"]').remove(),a.parent().find(".errors").remove(),a.parent().append('<p class="errors text-danger">'+t.data.msg+"</p>"),e('[name="fs_delivery_number"]').val("")}))}),1e3))})),e(document).on("click",'[data-fs-element="select-delivery-city"] li',(function(){let t=e(this);e('[name="fs_city"]').val(t.text()),e('[data-fs-element="select-warehouse"]').remove(),e('[data-fs-element="select-delivery-city"]').fadeOut(),e('[name="fs_delivery_number"]').val(""),e.ajax({type:"POST",url:fShop.ajaxurl,beforeSend:function(){e(document).trigger("fs_before_get_warehouses",{ref:t.data("ref"),cityName:t.data("name")}),e('[name="fs_delivery_number"]').parent().append('<img src="/wp-content/plugins/fs-new-mail/assets/img/preloader.svg" data-fs-element="select-warehouse-loader" class="loader">')},data:{action:"fs_get_warehouses",ref:t.data("ref"),cityName:t.data("name")},success:function(a){e(document).trigger("fs_after_get_warehouses",{ref:t.data("ref"),cityName:t.data("name"),...a}),e('[data-fs-element="select-warehouse-loader"]').remove();let n=e('[name="fs_delivery_number"]');if(a.success){e('[data-fs-element="select-warehouse"]').remove(),n.parent().find(".errors").remove();let t="";a.data.warehouses.length>0&&a.data.warehouses.forEach((function(e){t+='<li class="select-city-item" data-ref="'+e.ref+'">'+e.description+"</li>"}));let s=e('[name="fs_delivery_number"]');0!==e('[data-fs-element="select-warehouse"]').length?e('[data-fs-element="select-warehouse"]').html(t):s.after('<ul class="nm-city" data-fs-element="select-warehouse">'+t+"</ul>"),e("#fs-shipping-fields").length>0&&e("#fs-shipping-fields").append(a.data.html),e('[data-fs-element="delivery-cost"]').html(a.data.deliveryCost),e('[data-fs-element="total-amount"]').html(a.data.totalAmount)}else e('[data-fs-element="select-warehouse"]').remove(),n.parent().find(".errors").remove(),n.parent().append('<p class="errors text-danger">'+a.data.msg+"</p>"),n.val("")}})})),e(document).on("change",'[name="fs_delivery_methods"]',(function(a){var n=e(this);if(t()){e('[name="fs_adress"]').fadeOut(),e('[name="fs_delivery_number"],[name="fs_city"]').fadeIn();var s=e('[name="fs_city"]').val();""!=s&&function(t,a){e.ajax({url:FastShopData.ajaxurl,type:"POST",data:{action:"fs_get_warehouses",id:t,type:a},beforeSend:function(){}}).done((function(t){console.log(t);var a=e("[name='fs_delivery_number']").first();a.next().hasClass("nm-dnum")?a.next().html(t):a.after('<ul class="nm-dnum" data-fs-element="select-delivery-num">'+t+"</ul>"),e("#nm-dnum").fadeIn()}))}(s,n.val())}else e('[name="fs_adress"]').fadeIn(),e("#nm-dnum,#nm-city").fadeOut()})),e(document).on("click",'[data-fs-element="select-warehouse"] li',(function(t){e("[name='fs_delivery_number']").val(e(this).text()),e(this).parent().fadeOut()})),e(document).on("click",'[name="fs_delivery_number"]',(function(t){e('[data-fs-element="select-warehouse"]').fadeIn()}))}(jQuery);